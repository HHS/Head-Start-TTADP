name: DB Restore

on:
  workflow_dispatch:
    inputs:
      source:
        description: use processed (anonymized) or prod data
        required: true
        type: choice
        options: 
        - production
        - processed
        default: "processed"
      source_date:
        description: either "latest" or a date in YYYY-MM-DD format
        required: true
        type: string
        default: "latest"
      target_db:
        description: Name of the db to restore into, e.g. "ttahub-dev-blue"
        required: true
        type: choice
        options: 
        - ttahub-dev-blue
        - ttahub-dev-red
        - ttahub-dev-green
        - ttahub-dev-gold
        - ttahub-dev-pink

jobs:
  restore:
    runs-on: ubuntu-latest
    concurrency:
      group: db-restore
      cancel-in-progress: false
    steps:
      - name: Checkout repo
        uses: actions/checkout@v5
      - name: Login to Cloud Gov
        # https://github.com/cloud-gov/cg-cli-tools
        uses: cloud-gov/cg-cli-tools@main
        with:
          cf_username: ${{ secrets.CG_DEV_USERNAME }}
          cf_password: ${{ secrets.CG_DEV_PASSWORD }}
          cf_space: ${{ secrets.CG_DEV_SPACE }}
          cf_org: hhs-acf-ohs-tta
          cf_command: apps
