name: DB Restore
on:
  workflow_call:
    inputs:
      source:
        description: use processed (anonymized) or prod data
        required: true
        type: choice
        options: 
        - production
        - processed
        default: "processed"
      source_date:
        description: either "latest" or a date in YYYY-MM-DD format
        required: true
        type: string
        default: "latest"
      target_db:
        description: Name of the db to restore into, e.g. "ttahub-dev-blue"
        required: true
        type: choice
        options:
        options: 
        - ttahub-staging
        - ttahub-dev-blue
        - ttahub-dev-red
        - ttahub-dev-green
        - ttahub-dev-gold
        - ttahub-dev-pink
    secrets:
      github-token:
        required: true

jobs:
  db-restore:
    runs-on: ubuntu-latest
    concurrency:
      group: db-restore
      cancel-in-progress: false
    steps:
      - name: Checkout repo
        uses: actions/checkout@v5

      - name: Run restore script
        run: db_restore.sh ${{ github.event.inputs.source }} ${{ github.event.inputs.source_date }} ${{ github.event.inputs.target_db }}
